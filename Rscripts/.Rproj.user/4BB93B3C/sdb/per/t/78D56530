{
    "contents" : "#' ## Fit Huggins model using RMark\n#' \n#' \n#+ echo=FALSE \n # wd <- ifelse(basename(getwd())==\"Rscripts\", \n #               gsub(\"/Rscripts\", \"\", getwd()),\n #              getwd())\n #  opts_knit$set(root.dir=wd,comment=NA, fig.height=8, fig.width=12)\n  opts_knit$set(comment=NA, fig.height=8, fig.width=12)\n  rm(list = ls()) # clear out memory\n  \n#' Load libraries\n#+ warning=FALSE, message=FALSE \n   library(dplyr) # for data manipulation\n   library(RMark) # for fitting models\n   library(FSA) # for converting between data types\n   options(width=160)\n   \n#' Read in data created using \"Data Exploration.R\" file  \n  sampobs<-read.csv(\"../data/samps1.csv\")\n  \n#' Gender: Sex = 204.25 -> Male, Sex= 250.25 ->Female\n  sampobs$Sex2<-rep(\"1\",nrow(sampobs))\n  sampobs$Sex2[sampobs$Sex==250.25]<-0  \n\n#' Create a data set that contains a count of the number of times each bear was seen for each period\n  caphist<- sampobs%>%group_by(Individual, Period)%>%\n      summarize(Count= n())\n  \n#' Convert to Rmark file\n  capMark<-capHistConvert(caphist[,c(1,2)], id=\"Individual\", in.type=\"event\", out.type=\"RMark\")\n  sexid<-unique(select(sampobs, Individual, Sex2))\n  table(sexid$Sex2)\n  capMark2<-merge(capMark, sexid, all=FALSE)  \n  capMark3<-capMark2[,c(2,3)]\n  names(capMark3)[2]<-\"sex\"\n  \n#' Fit Huggins models (with sex covariate & behavioral response)\n\nrun.models=function(data)\n{\n#\n# Define parameter models\n#\nmod0=list(formula=~time+sex, share=TRUE)\nmod1=list(formula=~Time+sex, share=TRUE)\nmod2=list(formula=~c+sex, share=TRUE)\nmod3=list(formula=~time+c+sex, share=TRUE)\nmod4=list(formula=~Time+c+sex, share=TRUE)  \n\n# Run assortment of models\n#\n#\n# Capture Closed models\n#\n# time + sex\nm0<-mark(data,model=\"Huggins\",model.parameters=list(p=mod0))\n\n# Time trend + sex\nm1<-mark(data,model=\"Huggins\",model.parameters=list(p=mod1))\n\n# Behavioral response + sex\nm2<-mark(data,model=\"Huggins\",model.parameters=list(p=mod2))\n\n# time + Behavioral response + sex\nm3<-mark(data,model=\"Huggins\",model.parameters=list(p=mod3))\n \n# Time trend + Behavioral response + sex\nm4<-mark(data,model=\"Huggins\",model.parameters=list(p=mod4))\nreturn(collect.models())\n\n}\n  \n#' Results of models and model averaging \n  results=run.models(data=capMark3)  \n  \n\n\n#' Pull off N, Se, AICwt and put in table\n modelsum<-function(models){\n    mnames=models$model.table$model # Names of models\n    names<-names(models) # names of model objects\n    nl<-length(names)-1 # number of models fit\n    sumnames<-paste(deparse(substitute(models)),names[-(nl+1)], \"results\", \"derived\", \"'N Population Size'\", sep=\"$\")\n    SEnames<-paste(sumnames, \"se\", sep=\"$\")\n    Nnames<-paste(sumnames, \"estimate\", sep=\"$\")\n    N<-unlist(sapply(1:nl, FUN=function(x){eval(parse(text=Nnames[x]))}))\n    se<-unlist(sapply(1:nl, FUN=function(x){eval(parse(text=SEnames[x]))}))\n    wt<-models$model.table$weight\n    derived<-data.frame(model=mnames,AIC.wt=wt,N=N,se=se)\n    Nhat<-sum(N*wt)\n    sea<-sqrt(se^2+(N-Nhat)^2)\n    sea<-sum(se*wt)\n    derived2<-rbind(derived, data.frame(model=\"Model Average\", AIC.wt=NA,N=Nhat, se=sea))\n    derived2\n  }\n  modelsum(results)\n   \n  \n#' These models seem to be suggesting that capture probabilities\n#' are lower for males than females (opposite of the original spatial mr models I fit!). This lead me to wonder \n#' if I should also be modeling go~sex in the spatial MR models (detection probability might be lower NEAR the center, \n#' but bears migth move farther distances).  This would seem to make some sense...see secrall2.html\n  data.p<-data.frame(sex=c(0,1))\n\n#' Lets estimate capture probabilities for time 1 \n  est=covariate.predictions(results,data=data.p,indices=c(1))\n  est",
    "created" : 1439239300332.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "195708542",
    "id" : "78D56530",
    "lastKnownWriteTime" : 1439312159,
    "path" : "C:/Users/jfieberg/Google Drive/spatialMR/Rscripts/HuggyBear.R",
    "project_path" : "HuggyBear.R",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}