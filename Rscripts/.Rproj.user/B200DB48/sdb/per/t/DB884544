{
    "contents" : "#' ## Fit Huggins model using RMark\n#' \n#' \n#+ echo=FALSE \n # wd <- ifelse(basename(getwd())==\"Rscripts\", \n #               gsub(\"/Rscripts\", \"\", getwd()),\n #              getwd())\n #  opts_knit$set(root.dir=wd,comment=NA, fig.height=8, fig.width=12)\n  opts_knit$set(comment=NA, fig.height=8, fig.width=12)\n  rm(list = ls()) # clear out memory\n  \n#' Load libraries\n#+ warning=FALSE, message=FALSE \n   library(dplyr) # for data manipulation\n   library(RMark) # for fitting models\n   library(FSA) # for converting between data types\n   options(width=160)\n   \n#' Read in data created using \"Data Exploration.R\" file  \n  sampobs<-read.csv(\"../data/samps1.csv\")\n  \n#' Gender: Sex = 204.25 -> Male, Sex= 250.25 ->Female\n  sampobs$Sex2<-rep(\"1\",nrow(sampobs))\n  sampobs$Sex2[sampobs$Sex==250.25]<-0  \n\n#' Create a data set that contains a count of the number of times each bear was seen for each period\n  caphist<- sampobs%>%group_by(Individual, Period)%>%\n      summarize(Count= n())\n  \n#' Convert to Rmark file\n  capMark<-capHistConvert(caphist[,c(1,2)], id=\"Individual\", in.type=\"event\", out.type=\"RMark\")\n  sexid<-unique(select(sampobs, Individual, Sex2))\n  table(sexid$Sex2)\n  capMark2<-merge(capMark, sexid, all=FALSE)  \n  capMark3<-capMark2[,c(2,3)]\n  names(capMark3)[2]<-\"sex\"\n  \n#' Fit Huggins models (with sex covariate & behavioral response)\n\nrun.models=function(data)\n{\n#\n# Define parameter models\n#\nmod0=list(formula=~time+sex, share=TRUE)\nmod1=list(formula=~Time+sex, share=TRUE)\nmod2=list(formula=~c+sex, share=TRUE)\nmod3=list(formula=~time+c+sex, share=TRUE)\nmod4=list(formula=~Time+c+sex, share=TRUE)  \n\n# Run assortment of models\n#\n#\n# Capture Closed models\n#\n# time + sex\nm0<-mark(data,model=\"Huggins\",model.parameters=list(p=mod0))\n\n# Time trend + sex\nm1<-mark(data,model=\"Huggins\",model.parameters=list(p=mod1))\n\n# Behavioral response + sex\nm2<-mark(data,model=\"Huggins\",model.parameters=list(p=mod2))\n\n# time + Behavioral response + sex\nm3<-mark(data,model=\"Huggins\",model.parameters=list(p=mod3))\n \n# Time trend + Behavioral response + sex\nm4<-mark(data,model=\"Huggins\",model.parameters=list(p=mod4))\nreturn(collect.models())\n\n}\n  \n#' Results of models and model averaging \n  results=run.models(data=capMark3)  \n  \n\n\n\n#' Derived estimates of N\n  names=results$model.table$model\n  N<-c(results$m0$results$derived$estimate,results$m1$results$derived$estimate,results$m2$results$derived$estimate,results$m3$results$derived$estimate,results$m4$results$derived$estimate)\n  se<-c(results$m0$results$derived$se,results$m1$results$derived$se,results$m2$results$derived$se,results$m3$results$derived$se,results$m4$results$derived$se)\n  wt<-results$model.table$weight\n  derived<-data.frame(model=names,AIC.wt=wt,N=N,se=se)\n  derived\n\n\n#' #### Model averaged estimates of  N\n\n  Nhat<-sum(N*wt)\n  se<-sqrt(se^2+(N-Nhat)^2)\n  se<-sum(se*wt)\n  print(\"Model averaged N and se\")\n  Nhat\n  se\n  \n#' One thing that seems odd, is that these models seem to be suggesting that capture probabilities\n#' are lower for males than females (opposite of the spatial mr models!). This makes me wonder if I should\n#' also be modeling go~sex in the spatial MR models (detection probability might be lower NEAR the center, \n#' but bears migth move farther distances).  This would seem to make some sense...  \n  data.p<-data.frame(sex=c(0,1))\n\n#' Lets estimate capture probabilities for time 1 \n  est=covariate.predictions(results,data=data.p,indices=c(1))\n  est",
    "created" : 1439148761692.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3080233594",
    "id" : "DB884544",
    "lastKnownWriteTime" : 1439239470,
    "path" : "C:/Users/jfieberg/Google Drive/spatialMR/Rscripts/HuggyBear.R",
    "project_path" : "HuggyBear.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "source_on_save" : false,
    "type" : "r_source"
}