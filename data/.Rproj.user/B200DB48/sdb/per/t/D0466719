{
    "contents" : "#' ## Data Cleaning/Data Development\n#' \n#' \n#+ echo=FALSE \n  options(width=150)\n\n#' Load libraries\n#+ warning=FALSE, message=FALSE \n   library(dplyr) # for data manipulation\n   options(width=160)\n   \n#' Purpose:  to read in raw data from Karen's excel spradsheet, \"Karen's work Copy of g1288 results.xls\", \n#' look at a few data summaries, and check for errors.\n#' \n#' Read in raw data on samples and individuals tab (saved as .csv files)\n  ind<-read.csv(\"Individuals2.csv\")\n  head(ind)\n  samps<-read.csv(\"samples.csv\")\n  head(samps)\n  \n#' Data quality check:  compare number of samples on the \"individuals\" and \"samples\" tabs of Karen's Excel file\n  no.samps<-table(samps$Individual)\n  dat.no<-data.frame(names(no.samps),no.samps)[,-2]\n  alldat<-merge(ind, dat.no, by.x=\"Individual\", by.y=\"names.no.samps.\", all=TRUE )\n  summary(alldat$Freq- alldat$no_Samples) # Looks good\n\n#' Look at event IDs & Periods. Use strsplit to determine the site associated with each sample \n   events<-unlist(strsplit(as.character(samps$Event.ID), \"-\"))\n   samps$site<-as.numeric(sapply(strsplit(as.character(samps$Event.ID), \"-\"), `[`, 1))\n   samps$cid<-as.numeric(sapply(strsplit(as.character(samps$Event.ID), \"-\"), `[`, 2))\n  # samps$Per.check<-substr(samps$cid,1,1) # thought might be period, but it is not\n  # table(samps$Per.Check, samps$Period)\n  \n#' Note, there are several observations that are missing the sample Period.  A few of these appear to be samples\n#' of collared bears (so, perhaps these should not have a period & should be dropped).  Many correspond to \n#' Class = Xsubselect (not sent to lab).  Two correspond to sampled observations with a Priority, so these \n#' probably(?) represent data entry errors\n#'\n\n#' I will write these out ot a file for later checking, but also, below are three that should probably be given higher priority\n  filter(samps, Period==\"\", Lab.ID%in%c(26, 93, 1031))[,c(1:9, 16,18, 43, 44)]  \n  miss.period<-filter(samps, Period==\"\")[,c(1:9, 16,18, 43, 44)]\n  write.csv(miss.period, file=\"MissingPeriod.csv\", row.names=FALSE) \n   \n#' Look at the type of sample.  I'm not sure what all of these categories are, but will take a guess, below:\n#'\n#' - sample (sent to lab & processed without any problems)?\n#' - **xbomb (not sure)** any ideas?\n#' - Xinadequate (sent to lab, but sample was not adequate)\n#' - Xmixed (sent to lab, processed, contained a mixture of hair from different individuals)\n#' - **Xnotsent** (not sent, but not sure why - any ideas?)\n#' - Xspecies (sent to lab, processed, but not black bear hair?)\n#' - Xsubselect (low priority, ran out of money before could process?)\n#'\n#' Number of each type\n  table(samps$Class)\n  \n#' Lets look at a few of these categories.  \n#' \n#' **Xbomb**:  **Individual** is missing for all of the Xbomb observations, and priority is as high as 1. So,\n#' my guess is that an attempt was made to process these samples, but they were problematic in some way.\n  filter(samps, Class==\"Xbomb\")[,c(1:9, 16,18)]  \n   \n#' **Xinadequate**: similar story...\n  filter(samps, Class==\"Xinadequate\")[,c(1:9, 16,18)]  \n\n#' **Xmixed**:  similar story...\n  filter(samps, Class==\"Xmixed\")[,c(1:9, 16,18)]  \n\n#' **Xnotsent**:  Looks like these observations correspond to mislabeled / misbundled envelopes.  Only 4 of these. \n  filter(samps, Class==\"Xnotsent\")[,c(1:9, 16,18)]  \n   \n#' **Xspecies**:  hair likely from different species\n  filter(samps, Class==\"Xspecies\")[,c(1:9, 16,18)]  \n   \n#' **Xsubselect**:  some of these are high priority (so, not sure why they fell to end of list?)\n  filter(samps, Class==\"Xsubselect\")[,c(1:9, 16,18)]  \n\n#' #### Subsetting of data   \n#'\n#' At this point, I think it makes to subset the data to create 4 separate data sets:\n#' \n#'  1. Samples that were processed without any problems (Class = sample).  \n#'  2. Samples that were sent, but turned out to be problematic (Class = Xbomb, Xinadequate, Xmixed)\n#'  3. Samples that likely did not represent bear hair (Class = Xnotsent, Xspecies)\n#'  4. Samples that were not processed (Xsubselect)\n#'  \n#'  We will focus mostly on [1] going forward, but the other data sets may still prove useful, particularly if /\n#'  when we try to construct a reasonable simulation model.\n  sampobs<-filter(samps, Class==\"sample\")\n  samp.prob<-filter(samps, Class%in%c(\"Xbomb\", \"Xinadequate\", \"Xmixed\"))\n  samp.nobhair<-filter(samps, Class%in%c(\"Xnotsent\", \"Xspecies\"))\n  samp.noprocess<-filter(samps, Class==\"Xsubselect\")\n   \n#' #### Further exploration of Sampled Observations\n#'    \n#' At least 2 observations with Period = \"?6\".  Fix these, then turn this variable into a numeric variable\n  sampobs$Period[sampobs$Period==\"6?\"]<-\"6\"\n  table(sampobs$Period)\n  \n#' For now, drop observations that are missing Period.  Eventually, however, we will want to reconcile two of these highlighted earlier.\n#' The remaining 7 of correspond to observations from collared bears. \n  sampobs2<-filter(sampobs, Period!=\"\")\n\n#' Now, turn Period into a numeric variable  \n  sampobs2$Period<-droplevels(sampobs2$Period)  \n  sampobs2$Period<-as.numeric(sampobs2$Period)\n  table(sampobs2$Period)\n  \n#' Drop several of the columns that we will not need. \n  sampobs3<-sampobs2[,c(1:9, 16,18,43,44)] \n\n#' Write this file out for later use\n   write.csv(sampobs3, file=\"samps1.csv\", row.names=FALSE)  ",
    "created" : 1435868106920.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1574209970",
    "id" : "D0466719",
    "lastKnownWriteTime" : 1435941463,
    "path" : "~/umn_Research/spatialMR/Rscripts/Data Exploration.R",
    "project_path" : null,
    "properties" : {
        "tempName" : "Untitled1"
    },
    "source_on_save" : false,
    "type" : "r_source"
}